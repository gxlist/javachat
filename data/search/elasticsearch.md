# Lucene

## 介绍一下lucene?

Lucene全文检索库成熟、高性能、可扩展、轻量级、功能强大，而且使用简单、不依赖第三方，单个的Lucene库文件可以在程序中直接使用。结构概念包括：文档（document，包括多个字段的数据）、字段（field，包括字段的名称和内容）、词项（term）和词条（token，包括词项文本、开始和结束的偏移量、词条类型）。Lucene索引的数据结构为倒排索引，功能上通过把词项映射到文档及其数量，结构上包括一个有序的“词项-频率”字典和与词项对应的postings文件列表。以每个索引由多个创建后不修改的段组成，多个段会在段合并时被合并到一起。

# ES

## es的概念？

es对Lucene的封装实现了自动扩展的分布式集群功能。

逻辑概念包括：索引（数据库），类型（自定义的逻辑分类），文档（表的一行记录），映射（表结构）。

物理概念包括：集群，节点，分片（表），副本。

## es的架构

节点：es集群基于对等架构，每个物理节点Node默认是集群的一部分。集群默认使用Zen发现机制管理，发现方式包括默认的多播和单播。

索引：逻辑上的索引默认分为5个主分片（相当于kafka分区的首领副本），分布于不同的物理节点上，主分片数在索引创建后不可修改。每个主分片有0到多个副本（主分片不叫副本，计数方式与kafka不一样），默认1个，可以动态调整。

分片：一个es分片就是一个Lucene索引，包括多个setment。segment内部包括倒排索引（文档查找）、保存的字段（字段查找）、文档值（排序、聚合、切面）和缓存。

## es的工作过程

es节点启动时使用发现模块查找同一集群的节点，默认向网络广播请求。集群中节点编号小的节点优先被选举为主节点，负责管理集群状态，并在节点增减时重新分配索引分片。如果管理节点读取集群的状态信息后发现需要恢复，就检查所有索引的分片，并决定主分片，使系统进入可查询的黄色状态。然后寻找或创建足够的分片副本，使系统进入全功能的绿色状态。

es运行时会启动2个探测进程，分别用于主节点和其他节点通过发送ping请求来相互检测节点是否可用。理想的集群拓扑包括3个专用的主节点

（master:true,data:false），并且设置主节点的最小数量（discovery.zen.minimum_master_nodes:2）.

es索引一个文档时，会为文件建立相应的缓存，定期刷新到新的segments磁盘文件，就可以被搜索到，而过多的segment会在段合并时删掉。

## Elasticsearch中的倒排索引是什么？ 

倒排索引是搜索引擎的核心。搜索引擎的主要目标是在查找发生搜索条件的文档时提供快速搜索。倒排索引是一种像数据结构一样的散列图，可将用户从单词导向文档或网页。它是搜索引擎的核心。其主要目标是快速搜索从数百万文件中查找数据。 

一般情况下，像下面的一样，在书中我们已经倒过来索引。根据这个词，我们可以找到这个词所在的页面。

## ElasticSearch中的分析器是什么？

在ElasticSearch中索引数据时，数据由为索引定义的Analyzer在内部进行转换。 分析器由一个Tokenizer和零个或多个TokenFilter组成。编译器可以在一个或多个CharFilter之前。分析模块允许您在逻辑名称下注册分析器，然后可以在映射定义或某些API中引用它们。

Elasticsearch附带了许多可以随时使用的预建分析器。或者，您可以组合内置的字符过滤器，编译器和过滤器器来创建自定义分析器。

## 什么是ElasticSearch中的编译器？

编译器用于将字符串分解为术语或标记流。一个简单的编译器可能会将字符串拆分为任何遇到空格或标点的地方。Elasticsearch有许多内置标记器，可用于构建自定义分析器。

## 什么是ElasticSearch中的过滤器？

数据由Tokenizer处理后，在编制索引之前，过滤器会对其进行处理。

## 启用属性，索引和存储的用途是什么？

enabled属性适用于各类ElasticSearch特定/创建领域，如index和size。用户提供的字段没有“已启用”属性。 存储意味着数据由Lucene存储，如果询问，将返回这些数据。

存储字段不一定是可搜索的。默认情况下，字段不存储，但源文件是完整的。因为您希望使用默认值(这是有意义的)，所以不要设置store属性 该指数属性用于搜索。

索引属性只能用于搜索。只有索引域可以进行搜索。差异的原因是在分析期间对索引字段进行了转换，因此如果需要的话，您不能检索原始数据。