# 
$$
e=m^c
$$






## memcached的优缺点是什么？

memcached是简单的键值对内存缓存。

优点是：协议简单，使用文本或者二进制协议，不用xml。基于libevent的事件处理，解决了C10K问题。内置内存存储方式，不写磁盘，LRU回收策略。客户端分布式，路由到互不通信的memcached服务端，没有元数据管理节点。

缺点是：无法备份，重启不能恢复，可以通过持久化(MemcacheDB或者Tokyo Cabinet)解决。无法按条件查询。没有内置安全机制。单点故障或者过期掉数据，可以通过主从模式来解决，更新数据时先获取数据，先后cas更新master和slave，失败则全删。

## memcached防止内存碎片的机制是什么？

内存存储的 slab allocation 机制防止了内存碎片。按照默认88字节和1.25的增长因子，将每个page默认1M的内存分成chunk，相同大小的chunk块构成slab片。

memcached保留slab内空闲chunk块的大小，根据收到的数据大小，选择最合适的slab片。解决了内存碎片后，又产生了内存利用不足的问题。

## memcached的过期机制是什么？

memcached的过期机制包括：lazy惰性检查时间戳，slab片内的LRU算法(通过-M参数禁止，用尽内存后返回错误，而-m参数则是指定最大内存)。

## memcached集群的工作过程是什么？

memcached集群的管理，首次一致性哈希找机器，可以减少集群动态伸缩的影响。二次哈希找键值对，是在机器内部发生。

## memcached的热点数据如何处理？

热点数据，可以将数据向前移动到客户端缓存，也可以把key映射为多个别名，分散到多台服务器上缓存。

## 数据库和缓存哪个先更新？

由于缓存是不可靠的，不能作为存储。所以建议先更新数据库，再更新缓存，缓存更新失败会使数据不一致，业务上的使用场景要允许。

如果因为添加机器或者重启，缓存数据没有预热加载，就会导致服务不可用，怎么解决？

从文件或者其他存储加载最少配置。数据库的高可用则是通过主从/主主来实现的。

## memcached常用的客户端有哪些？

常用的java客户端包括Spymemcached和Xmemcached，